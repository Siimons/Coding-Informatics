## Основы Kubernetes

### 1. Что такое Kubernetes?

Kubernetes — это система для автоматизации развёртывания, масштабирования и управления контейнеризованными приложениями. Он был создан Google и является лидером в мире оркестрации контейнеров.

**Основные задачи Kubernetes:**

- Автоматизация развертывания и управления контейнерами.
- Поддержка отказоустойчивости и восстановления.
- Балансировка нагрузки между контейнерами.
- Легкость в горизонтальном масштабировании приложений.

### 2. Основные компоненты Kubernetes

1. **Cluster (Кластер)** — набор узлов (серверов), объединённых вместе для работы приложений.
    
    - **Master (Узел управления)** — управляет кластером и его состоянием.
    - **Worker (Рабочие узлы)** — запускают приложения в контейнерах.
    
2. **Pod (Под)** — это наименьшая единица в Kubernetes. Это набор контейнеров, которые разделяют сетевые и дисковые ресурсы.
    
    - Обычно один контейнер на Pod, но иногда может быть несколько, если они тесно связаны.
    
3. **Service (Сервис)** — это постоянная точка доступа для приложений, даже если их Pod'ы могут перезапускаться или перемещаться.
    
4. **Namespace (Пространство имён)** — логическое разделение ресурсов в кластере. Оно позволяет изолировать среды (например, продакшн, тестирование).
    
5. **Deployment (Деплоймент)** — описывает, как приложение должно быть развернуто (сколько подов, какие версии образов, политики обновления и т.д.).

### 3. Основные преимущества Kubernetes

- **Масштабирование**: Автоматическое увеличение или уменьшение числа контейнеров в зависимости от нагрузки.
- **Самовосстановление**: Kubernetes перезапустит упавшие поды, заменит или перераспределит их.
- **Декларативное управление**: Все состояния описаны в конфигурациях, которые управляют жизненным циклом приложений.
- **Гибкость**: Kubernetes может быть развёрнут в любой среде: локально, в облаке или гибридно.

### Пример структуры конфигурации

Обычно в Kubernetes вся инфраструктура описывается через YAML файлы. Вот пример конфигурационного файла для **Deployment**:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deployment
  labels:
    app: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app-container
        image: nginx:1.19
        ports:
        - containerPort: 80
```
Этот YAML файл описывает deployment:

- **replicas: 3** — Kubernetes создаст три экземпляра приложения (три Pod'а).
- **image: nginx:1.19** — каждый Pod будет запускать контейнер с образом nginx версии 1.19.
- **containerPort: 80** — контейнер будет слушать 80-й порт.

## Архитектура Kubernetes

### 1. Компоненты Master-узла

1. **API Server**: Принимает команды от пользователя (например, через `kubectl`) и взаимодействует с другими компонентами.
    
2. **Controller Manager**: Следит за состоянием кластера и автоматически восстанавливает его, если что-то не так (например, поды упали).
    
3. **Scheduler**: Назначает поды на подходящие рабочие узлы.
    
4. **etcd**: Распределённое хранилище данных, в котором хранится состояние кластера (например, какие поды где работают).

### 2. Компоненты Worker-узла

1. **Kubelet**: Основной агент на каждом рабочем узле, который отвечает за запуск подов и контейнеров на этом узле.
    
2. **Container Runtime**: Это система, которая запускает контейнеры. Самый распространённый runtime — Docker, но Kubernetes поддерживает и другие (например, containerd, cri-o).
    
3. **Kube-proxy**: Этот компонент отвечает за сетевые соединения и балансировку нагрузки внутри кластера.
