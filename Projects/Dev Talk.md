Это мой pet-проект по разработке сервиса для публикации статей **Dev Talk**, который предполагает микросервисную архитектуру. Проект включает три основных микросервиса: `auth` для аутентификации пользователей, `articles` для управления статьями и `comments` для работы с комментариями. Для реализации функциональности используются современные технологии, такие как: **FastAPI** для создания API, **MySQL** для хранения данных, **Redis** для кэширования, **Kafka** для обмена сообщениями между микросервисами и **Docker** для контейнеризации и удобного развёртывания приложения.

## Файловая структура всего проекта
```
dev-talk/
├── auth/
│   ├── src/
│   │   ├── router.py               # Роуты для аутентификации
│   │   ├── schemas.py              # Pydantic-схемы для валидации данных
│   │   ├── service.py              # Бизнес-логика для работы с пользователями
│   │   ├── models.py               # SQLAlchemy-модели для пользователей
│   │   ├── config.py               # Конфигурации
│   │   ├── kafka_producer.py       # Kafka продюсер
│   │   ├── kafka_consumer.py       # Kafka консьюмер (если требуется)
│   │   └── utils.py                # Вспомогательные функции
│   ├── tests/
│   │   └── test_auth.py            # Тесты для auth
│   ├── Dockerfile                  # Docker-конфигурация для микросервиса auth
│   ├── main.py                     # Точка входа для FastAPI
│   ├── requirements.txt            # Зависимости Python
│   └── .env                        # Переменные окружения
│
├── articles/
│   ├── src/
│   │   ├── router.py               # Роуты для CRUD операций со статьями
│   │   ├── schemas.py              # Pydantic-схемы для статей
│   │   ├── service.py              # Бизнес-логика для статей
│   │   ├── models.py               # SQLAlchemy-модели для статей
│   │   ├── config.py               # Конфигурации (например, база данных, Redis)
│   │   ├── kafka_producer.py       # Kafka продюсер (например, уведомления)
│   │   ├── kafka_consumer.py       # Kafka консьюмер
│   │   └── utils.py                # Вспомогательные функции
│   ├── tests/
│   │   └── test_articles.py        # Тесты для статей
│   ├── Dockerfile                  # Docker-конфигурация для микросервиса статей
│   ├── main.py                     # Точка входа для FastAPI
│   ├── requirements.txt            # Зависимости Python
│   └── .env                        # Переменные окружения
│
├── comments/
│   ├── src/
│   │   ├── router.py               # Роуты для CRUD операций с комментариями
│   │   ├── schemas.py              # Pydantic-схемы для комментариев
│   │   ├── service.py              # Бизнес-логика для комментариев
│   │   ├── models.py               # SQLAlchemy-модели для комментариев
│   │   ├── config.py               # Конфигурации (например, база данных, Redis)
│   │   ├── kafka_producer.py       # Kafka продюсер
│   │   ├── kafka_consumer.py       # Kafka консьюмер
│   │   └── utils.py                # Вспомогательные функции
│   ├── tests/
│   │   └── test_comments.py        # Тесты для комментариев
│   ├── Dockerfile                  # Docker-конфигурация
│   ├── main.py                     # Точка входа для FastAPI
│   ├── requirements.txt            # Зависимости Python
│   └── .env                        # Переменные окружения
│
├── db/                             # Общая папка для работы с базой данных
│   ├── migrations/                 # Миграции базы данных
│   ├── models/                     # Глобальные модели для всех микросервисов
│   ├── database.py                 # Логика подключения к базе данных
│   └── alembic.ini                 # Конфигурация Alembic
│
├── kafka/                          # Общие настройки Kafka
│   ├── docker-compose.yml          # Конфигурация для Kafka и Zookeeper
│   ├── producer.py                 # Общий Kafka продюсер
│   ├── consumer.py                 # Общий Kafka консьюмер
│
├── redis/                          # Настройки Redis
│   ├── redis.conf                  # Конфигурация Redis
│   ├── docker-compose.yml          # Docker Compose для Redis
│
├── gateway/                        # API Gateway для маршрутизации запросов
│   ├── src/
│   │   └── main.py           # Логика маршрутизации запросов к микросервисам
│   ├── Dockerfile            # Docker-конфигурация для API Gateway
│
├── docker-compose.yml        # Общий Docker Compose для всех микросервисов
└── .env                      # Общие переменные окружения
```

## Файловая структура каждого микросервиса

#### 1. **Auth Service (dev-talk-auth)**

Микросервис аутентификации отвечает за регистрацию пользователей, вход в систему, управление сессиями и проверку прав доступа.
```
dev-talk-auth/
├── src/
│   ├── router.py               # Маршруты для аутентификации
│   ├── schemas.py              # Pydantic-схемы (например, UserCreate, Token)
│   ├── service.py              # Бизнес-логика для управления пользователями
│   ├── models.py               # SQLAlchemy-модели для пользователей
│   ├── dependencies.py         # Зависимости для проверок токенов и прав доступа
│   ├── config.py               # Конфигурации микросервиса
│   ├── exceptions.py           # Обработка исключений
│   ├── kafka_producer.py       # Продюсер Kafka
│   ├── redis_cache.py          # Логика для работы с Redis
│   └── utils.py                # Утилиты
├── tests/
│   ├── test_auth.py            # Тесты для бизнес-логики и API
│   └── test_utils.py           # Тесты для вспомогательных функций
├── Dockerfile                  # Docker-конфигурация для микросервиса
├── main.py                     # Точка входа для FastAPI
├── requirements.txt            # Зависимости Python
└── .env                        # Переменные окружения
```

#### 2. **Articles Service (dev-talk-articles)**

Микросервис для управления статьями — создание, редактирование, получение и удаление статей.
```
dev-talk-articles/
├── src/
│   ├── router.py               # Маршруты для CRUD-операций со статьями
│   ├── schemas.py              # Pydantic-схемы для запросов и ответов
│   ├── service.py              # Бизнес-логика для работы со статьями
│   ├── models.py               # SQLAlchemy-модели для статей
│   ├── dependencies.py         # Зависимости
│   ├── config.py               # Конфигурации микросервиса
│   ├── kafka_producer.py       # Продюсер Kafka для уведомлений
│   ├── kafka_consumer.py       # Консьюмер Kafka
│   ├── redis_cache.py          # Кэширование данных о статьях
│   └── utils.py                # Вспомогательные функции
├── tests/
│   ├── test_articles.py        # Тесты для бизнес-логики и API
│   └── test_schemas.py         # Тесты для схем
├── Dockerfile                  # Docker-конфигурация для микросервиса
├── main.py                     # Точка входа для FastAPI
├── requirements.txt            # Зависимости Python
└── .env                        # Переменные окружения
```

#### 3. **Comments Service (dev-talk-comments)**

Микросервис для управления комментариями — создание, редактирование и удаление комментариев, а также получение комментариев для статей.
```
dev-talk-comments/
├── src/
│   ├── router.py               # Маршруты для CRUD-операций с комментариями
│   ├── schemas.py              # Pydantic-схемы для комментариев
│   ├── service.py              # Бизнес-логика для работы с комментариями
│   ├── models.py               # SQLAlchemy-модели для комментариев
│   ├── dependencies.py         # Зависимости
│   ├── config.py               # Конфигурации микросервиса
│   ├── kafka_producer.py       # Продюсер Kafka
│   ├── kafka_consumer.py       # Консьюмер Kafka
│   ├── redis_cache.py          # Кэширование данных о комментариях
│   └── utils.py                # Вспомогательные функции
├── tests/
│   ├── test_comments.py        # Тесты для бизнес-логики и API
│   └── test_schemas.py         # Тесты для схем
├── Dockerfile                  # Docker-конфигурация для микросервиса
├── main.py                     # Точка входа для FastAPI
├── requirements.txt            # Зависимости Python
└── .env                        # Переменные окружения
```

#### 4. **API Gateway (dev-talk-gateway)**

API Gateway используется для маршрутизации запросов к различным микросервисам. Он управляет внешним взаимодействием с клиентами (например, веб-приложением), проверяет токены доступа и перенаправляет запросы на соответствующие микросервисы.
```
dev-talk-gateway/
├── src/
│   ├── routes/
│   │   ├── auth.py             # Проксирование запросов на Auth Service
│   │   ├── articles.py         # Проксирование запросов на Articles Service
│   │   └── comments.py         # Проксирование запросов на Comments Service
│   ├── config.py               # Конфигурации для взаимодействия с сервисами
│   └── middleware.py           # Middleware для аутентификации и логирования
├── Dockerfile                  # Docker-конфигурация для микросервиса
├── main.py                     # Точка входа для FastAPI
├── requirements.txt            # Зависимости Python
└── .env                        # Переменные окружения (например, URL-ы сервисов)
```

## Взаимодействие микросервисов

1. **Auth Service**: Отвечает за управление пользователями. Все другие сервисы используют токены, выданные этим сервисом, для проверки авторизации через API Gateway или напрямую.
    
2. **Articles Service**: Управляет статьями. Взаимодействует с **Comments Service**, предоставляя данные о статьях, к которым пользователи могут добавлять комментарии. Кэширует данные о популярных статьях с помощью **Redis** и отправляет события о новых статьях через **Kafka**.
    
3. **Comments Service**: Управляет комментариями. Слушает события от **Articles Service** через **Kafka** и кэширует данные о комментариях с помощью **Redis**.
    
4. **API Gateway**: Маршрутизирует запросы к правильным микросервисам и проводит проверку токенов через **Auth Service**.